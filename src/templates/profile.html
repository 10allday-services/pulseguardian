{% extends 'base.html' %}


{% block body %}
{% set inspected_users = users if cur_user.admin else [cur_user] %}

<a href="#" class="autoreload">
    <span class="glyphicon glyphicon-refresh"></span> Auto-reload
</a>

{% for user in inspected_users %}
    <div class="user" data-email="{{user.email}}">
        <h2 class="text-primary">
            <small>Profile:</small> {{user.username}}
        </h2>

        <h3>Queues</h3>

        {% if user.queues %}
        <ul class="list-group queues">
        {% for queue in user.queues %}

            {% set fill_perc = (100 * queue.size / config.del_queue_size) | int %}
            {% set warning =  queue.size > config.warn_queue_size | int %}
            {% set bar_class = 'progress-bar-danger' if warning else '' %}

            <li class="list-group-item queue" data-queue-name="{{queue.name}}">
                {% if cur_user.admin or user == cur_user %}
                    <span class="glyphicon glyphicon-remove delete"></span>
                {% endif %}
                <h4>
                    {% if warning %}<span class="label label-danger">Warning</span>{% endif %}
                    {{queue.name}} <small>{{queue.size}} messages</small>

                </h4>

                <div class="progress">
                    <div class="progress-bar {{bar_class}}" role="progressbar" aria-valuenow="{{queue.size}}" aria-valuemin="0"
                         aria-valuemax="{{config.del_queue_size}}" style="width: {{fill_perc}}%;">
                        {% if fill_perc > 0 %} {{fill_perc}}% {% endif%}
                    </div>
                </div>

            </li>
        {% endfor %}
        </ul>
        {% else %}
        <p>
            No queues for now!
        </p>
        {% endif %}
    </div>
{% endfor %}


{% endblock %}

{% block javascript %}
<script type="text/javascript" src="/static/js/profile.js"></script>
{% endblock %}